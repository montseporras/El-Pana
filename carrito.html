<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tu pedido</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>

<div id="header-container"></div>

<main class="cart-page">

    <div class="section-titlearepa">
        <button class="back-button" onclick="history.back()">←</button>
        <h1>Tu pedido</h1>
    </div>

    <div id="cart-list"></div>

    <div class="cart-summary">
        <span>Total</span>
        <strong id="cart-total">$0</strong>
    </div>

    <button class="confirm-button" id="confirm-order">
        Confirmar pedido
    </button>

</main>

<script src="products-data.js"></script>
<script src="script.js"></script>

<script>
/* ================= HEADER ================= */
fetch("header.html")
    .then(r => r.text())
    .then(html => {
        document.getElementById("header-container").innerHTML = html;
        updateCartCount();
    });

/* ================= CARRITO ================= */
const cartList = document.getElementById("cart-list");
const totalEl = document.getElementById("cart-total");

function getCart() {
    return JSON.parse(localStorage.getItem("cart")) || [];
}

function saveCart(cart) {
    localStorage.setItem("cart", JSON.stringify(cart));
    renderCart();
    updateCartCount();
}

/* ================= CONTADOR HEADER ================= */
function updateCartCount() {
    const el = document.getElementById("cart-count");
    if (!el) return;
    const cart = getCart();
    el.textContent = cart.reduce((sum, i) => sum + i.quantity, 0);
}

/* ================= RENDER ================= */
function renderCart() {
    const cart = getCart();
    cartList.innerHTML = "";

    if (cart.length === 0) {
        cartList.innerHTML = "<p style='padding:20px'>Tu carrito está vacío</p>";
        totalEl.textContent = "$0";
        return;
    }

    let total = 0;

    cart.forEach((item, index) => {
        const subtotal = item.priceUnit * item.quantity;
        total += subtotal;

        const div = document.createElement("div");
        div.className = "cart-item";

        div.innerHTML = `
            <div class="cart-item-info">
                <h3>${item.name}</h3>

                ${item.salsa ? `<p><strong>Salsa:</strong> ${item.salsa}</p>` : ""}

                ${item.rellenos && item.rellenos.length
                    ? `<p><strong>Extras:</strong> ${item.rellenos.join(", ")}</p>`
                    : ""}

                ${item.note ? `<p><em>${item.note}</em></p>` : ""}
            </div>

            <div class="cart-item-actions">
                <button onclick="changeQty(${index}, -1)">−</button>
                <span>${item.quantity}</span>
                <button onclick="changeQty(${index}, 1)">+</button>
            </div>

            <div class="cart-item-price">
                $${subtotal}
                <button class="remove-btn" onclick="removeItem(${index})">✕</button>
            </div>
        `;

        cartList.appendChild(div);
    });

    totalEl.textContent = `$${total}`;
}

/* ================= CANTIDAD ================= */
function changeQty(index, delta) {
    const cart = getCart();
    cart[index].quantity += delta;

    if (cart[index].quantity <= 0) {
        cart.splice(index, 1);
    }

    saveCart(cart);
}

function removeItem(index) {
    const cart = getCart();
    cart.splice(index, 1);
    saveCart(cart);
}

/* ================= CONFIRMAR ================= */
document.getElementById("confirm-order").addEventListener("click", () => {
    if (getCart().length === 0) {
        alert("El carrito está vacío");
        return;
    }
    window.location.href = "checkout.html";
});

renderCart();
</script>

</body>
</html>
